(function(){const i=document.createElement("link").relList;if(i&&i.supports&&i.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))o(n);new MutationObserver(n=>{for(const s of n)if(s.type==="childList")for(const l of s.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&o(l)}).observe(document,{childList:!0,subtree:!0});function r(n){const s={};return n.integrity&&(s.integrity=n.integrity),n.referrerPolicy&&(s.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?s.credentials="include":n.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function o(n){if(n.ep)return;n.ep=!0;const s=r(n);fetch(n.href,s)}})();const p=e=>{const i=document.getElementById(e);if(i===null)throw new Error(`Cannot find element ${e}.`);return i},F=(e,i=null)=>r=>r.hasOwnProperty(e)?r[e]:i;function v(e){var i=e.lastIndexOf(".");return i===-1?e:e.substring(0,i)}function O(e){const i=e.split(`
`).filter(o=>o.trim()!=="");let r=[];return i.forEach(o=>{const n=o.trim(),s=/\[\d{2}:\d{2}\.\d{2}\]/g,l=n.match(s);if(l&&l.length>1){const a=n.replace(s,"").trim();l.forEach(u=>{r.push(`${u}${a}`)})}else r.push(n)}),r.sort(),r}function P(e){const o=O(e).filter(n=>!(n.startsWith("[")&&n.endsWith("]"))).map(n=>{const s=n.match(/^\[\d\d?:\d\d?\.\d\d?\]/);let l=0;return s&&(l=s[0].length),{timestamp:A(n.substring(0,l)),text:n.substring(l)}});return[{timestamp:0,text:""},...o]}function b(e){return e.split(`
`).map(o=>({text:o}))}function A(e){const r=e.replace(/[[\]]/g,"").split(":"),o=parseInt(r[0]),n=parseFloat(r[1]);return o*60+n}let c,g,t={lines:[],filesList:[],fileType:"txt",numberOfLines:10,currentLineIndex:0,currentFileIndex:0},m=null;function S(e,i,r){c=i,g=r;const o=Array.from(e.target.files);t.filesList=o.filter(s=>s.webkitRelativePath.toLowerCase().endsWith(".txt")||s.webkitRelativePath.toLowerCase().endsWith(".lrc"));const n=o.find(s=>s.name.toLowerCase()==="_lyrics.playlist.txt");if(n){const s=new FileReader;s.onload=function(l){const a=l.target.result;if(a){const u=a.split(`
`).map(d=>d.trim()).filter(d=>d!==""),I=t.filesList.sort((d,E)=>{const T=u.indexOf(d.name),C=u.indexOf(E.name);return T-C});t.filesList=I,t.currentFileIndex=-1,f()}},s.onerror=function(l){console.error("Error reading file:",l.target.error)},s.readAsText(n)}else t.currentFileIndex=-1,f();e.target.classList.add("hidden")}function N(e,i=""){const r=document.createElement("li");r.textContent=i,r.classList.add("zero"),e.prepend(r),e.lastElementChild&&e.lastElementChild.remove();const o=e.firstElementChild;if(o){o.offsetWidth,o.classList.remove("zero"),o.classList.add("large");const n=e.getElementsByTagName("li")[1];n&&n.classList.remove("large")}}function W(e,i=""){e.querySelectorAll(".zero").forEach(n=>n.remove());const r=e.firstElementChild;if(r){r.classList.remove("large"),r.classList.add("zero");const n=e.getElementsByTagName("li")[1];n&&n.classList.add("large"),r.addEventListener("transitionend",s=>s.target.remove())}const o=document.createElement("li");o.textContent=i,e.appendChild(o)}function L(){if(m&&clearTimeout(m),t.fileType==="lrc"&&t.lines[t.currentLineIndex]&&t.lines[t.currentLineIndex+1]){const e=t.lines[t.currentLineIndex].timestamp,r=t.lines[t.currentLineIndex+1].timestamp-e;r>0&&(m=setTimeout(x,r*1e3))}}function h(){for(L();c.firstChild;)c.firstChild.remove();const e=t.lines.slice(t.currentLineIndex,t.currentLineIndex+t.numberOfLines).map(F("text",""));for(let i of e){const r=document.createElement("li");r.textContent=i,c.appendChild(r)}}function y(e){let i=new FileReader;i.onload=function(r){const o=r.target.result;e.name.toLowerCase().endsWith(".lrc")?(t.fileType="lrc",t.lines=P(o)):e.name.toLowerCase().endsWith(".txt")&&(t.fileType="txt",t.lines=b(o)),t.currentLineIndex=0,g.textContent=v(e.name),h()},i.onerror=function(r){console.error("Error reading file:",r.target.error)},i.readAsText(e)}function f(){t.currentFileIndex<t.filesList.length&&(t.currentFileIndex++,y(t.filesList[t.currentFileIndex]))}function R(){t.currentLineIndex>2?(t.currentLineIndex=0,h()):t.currentFileIndex>0&&(t.currentFileIndex--,y(t.filesList[t.currentFileIndex]))}function x(){t.currentLineIndex++,t.currentLineIndex>=t.lines.length&&f(),L();const e=t.lines[t.currentLineIndex+t.numberOfLines-1],i=e?e.text:"";W(c,i)}function z(){t.currentLineIndex--,L();const e=t.lines[t.currentLineIndex],i=e?e.text:"";N(c,i)}const w=p("lyricsContainer"),K=p("songTitle");p("fileInput").addEventListener("change",e=>S(e,w,K));document.addEventListener("keydown",function(e){e.code==="KeyH"&&w.classList.toggle("hidden")});document.addEventListener("keydown",function(e){e.code==="Space"||e.code==="ArrowDown"||e.code==="ArrowRight"?x():(e.code==="ArrowUp"||e.code==="ArrowLeft")&&z()});document.addEventListener("touchstart",function(){x()});document.addEventListener("keydown",function(e){e.code==="KeyN"?f():e.code==="KeyP"&&R()});(!window.FileReader||!window.FileList||!window.File||!window.Blob)&&alert("Your browser does not support the required APIs. Please use a modern browser.");
