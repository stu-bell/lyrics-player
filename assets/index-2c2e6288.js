(function(){const r=document.createElement("link").relList;if(r&&r.supports&&r.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))s(n);new MutationObserver(n=>{for(const o of n)if(o.type==="childList")for(const l of o.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&s(l)}).observe(document,{childList:!0,subtree:!0});function i(n){const o={};return n.integrity&&(o.integrity=n.integrity),n.referrerPolicy&&(o.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?o.credentials="include":n.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function s(n){if(n.ep)return;n.ep=!0;const o=i(n);fetch(n.href,o)}})();const p=e=>{const r=document.getElementById(e);if(r===null)throw new Error(`Cannot find element ${e}.`);return r},O=(e,r=null)=>i=>i.hasOwnProperty(e)?i[e]:r;function P(e){var r=e.lastIndexOf(".");return r===-1?e:e.substring(0,r)}const g=async e=>new Promise((r,i)=>{const s=new FileReader;s.onload=function(n){r(n.target.result)},s.onerror=n=>{var o;i("Error reading file:"+((o=n.target.error)==null?void 0:o.message))},s.readAsText(e)});function A(e){const r=e.split(`
`).filter(s=>s.trim()!=="");let i=[];return r.forEach(s=>{const n=s.trim(),o=/\[\d{2}:\d{2}\.\d{2}\]/g,l=n.match(o);if(l&&l.length>1){const c=n.replace(o,"").trim();l.forEach(u=>{i.push(`${u}${c}`)})}else i.push(n)}),i.sort(),i}function b(e){const s=A(e).filter(n=>!(n.startsWith("[")&&n.endsWith("]"))).map(n=>{const o=n.match(/^\[\d\d?:\d\d?\.\d\d?\]/);let l=0;return o&&(l=o[0].length),{timestamp:N(n.substring(0,l)),text:n.substring(l)}});return[{timestamp:0,text:""},...s]}function S(e){return e.split(`
`).map(s=>({text:s}))}function N(e){const i=e.replace(/[[\]]/g,"").split(":"),s=parseInt(i[0]),n=parseFloat(i[1]);return s*60+n}let d,h,t={lines:[],filesList:[],fileType:"txt",numberOfLines:10,currentLineIndex:0,currentFileIndex:0};async function W(e,r,i){if(d=r,h=i,!e.target){console.error("Null input target");return}const s=e.target,n=s.files,o=Array.from(n);t.filesList=o.filter(c=>c.webkitRelativePath.toLowerCase().endsWith(".txt")||c.webkitRelativePath.toLowerCase().endsWith(".lrc"));const l=o.find(c=>c.name.toLowerCase()==="_lyrics.playlist.txt");if(l){const u=(await g(l)).split(`
`).map(a=>a.trim()).filter(a=>a!==""),E=t.filesList.sort((a,C)=>{const F=u.indexOf(a.name),v=u.indexOf(C.name);return F-v});t.filesList=E,t.currentFileIndex=-1,f()}else t.currentFileIndex=-1,f();s.classList.add("hidden")}function D(e,r=""){const i=document.createElement("li");i.textContent=r,i.classList.add("zero"),e.prepend(i),e.lastElementChild&&e.lastElementChild.remove();const s=e.firstElementChild;if(s){s.offsetWidth,s.classList.remove("zero"),s.classList.add("large");const n=e.getElementsByTagName("li")[1];n&&n.classList.remove("large")}}function R(e,r=""){e.querySelectorAll(".zero").forEach(n=>n.remove());const i=e.firstElementChild;if(i){i.classList.remove("large"),i.classList.add("zero");const n=e.getElementsByTagName("li")[1];n&&n.classList.add("large"),i.addEventListener("transitionend",o=>o.target.remove())}const s=document.createElement("li");s.textContent=r,e.appendChild(s)}let m=null,y;function L(){if(m&&clearTimeout(m),t.fileType==="lrc"&&t.lines[t.currentLineIndex]&&t.lines[t.currentLineIndex+1]){const e=t.lines[t.currentLineIndex].timestamp,i=t.lines[t.currentLineIndex+1].timestamp-e;i>0&&(m=setTimeout(()=>{y=Date.now(),x()},i*1e3))}}const z=(e=500)=>Date.now()-y<e;function w(){for(L();d.firstChild;)d.firstChild.remove();const e=t.lines.slice(t.currentLineIndex,t.currentLineIndex+t.numberOfLines).map(O("text",""));for(let r of e){const i=document.createElement("li");i.textContent=r,d.appendChild(i)}}async function I(e){const r=await g(e);e.name.toLowerCase().endsWith(".lrc")?(t.fileType="lrc",t.lines=b(r)):e.name.toLowerCase().endsWith(".txt")&&(t.fileType="txt",t.lines=S(r)),t.currentLineIndex=0,h.textContent=P(e.name),w()}function f(){t.currentFileIndex<t.filesList.length&&(t.currentFileIndex++,I(t.filesList[t.currentFileIndex]))}function K(){t.currentLineIndex>2?(t.currentLineIndex=0,w()):t.currentFileIndex>0&&(t.currentFileIndex--,I(t.filesList[t.currentFileIndex]))}function x(){t.currentLineIndex++,t.currentLineIndex>=t.lines.length&&f(),L();const e=t.lines[t.currentLineIndex+t.numberOfLines-1],r=e?e.text:"";R(d,r)}function q(){t.currentLineIndex--,L();const e=t.lines[t.currentLineIndex],r=e?e.text:"";D(d,r)}const T=p("lyricsContainer"),B=p("songTitle");p("fileInput").addEventListener("change",e=>W(e,T,B));document.addEventListener("keydown",function(e){e.code==="KeyH"&&T.classList.toggle("hidden")});document.addEventListener("keydown",function(e){(e.code==="Space"||e.code==="ArrowDown"||e.code==="ArrowRight")&&!z(500)?x():(e.code==="ArrowUp"||e.code==="ArrowLeft")&&q()});document.addEventListener("touchstart",function(){x()});document.addEventListener("keydown",function(e){e.code==="KeyN"?f():e.code==="KeyP"&&K()});(!window.FileReader||!window.FileList||!window.File||!window.Blob)&&alert("Your browser does not support the required APIs. Please use a modern browser.");
